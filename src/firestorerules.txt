rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
      // only specific user can modify own information
      match /users/{userdocid}{
        allow read;
        allow create: if request.auth != null && request.auth.token.email != null;
        allow write: if request.auth != null && request.auth.uid == resource.data.uid;
      }
      match /tasklists/{listid}{
        function listData() {
            return get(/databases/$(database)/documents/tasklists/$(listid)).data
        }
        
        allow create: if request.auth != null && request.auth.token.email != null;
      	allow read: if request.auth != null && request.auth.token.email in resource.data.users;
        allow write: if request.auth != null && request.auth.token.email == resource.data.owner;
        
				
        match /tasks/{taskid}{
        		allow read, write: if request.auth != null && request.auth.token.email in listData().users;
        }
      }
  }
}